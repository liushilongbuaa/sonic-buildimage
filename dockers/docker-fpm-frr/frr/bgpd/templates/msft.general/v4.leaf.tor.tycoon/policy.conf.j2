!
! template: bgpd/templates/msft.general/v4.leaf.tor.tycoon/policy.conf.j2
!
bgp community-list standard TYCOON_ER_COMMUNITY permit 12076:10450
bgp community-list standard TYCOON_ER_COMMUNITY permit 8075:10451
bgp community-list standard SDN_APPLIANCE_COMMUNITY permit 8075:9302
bgp community-list standard UPSTREAM_PREFIX permit 8075:54000
bgp community-list standard drop_community permit no-export
!
bgp as-path access-list BBR_AS_PATH permit ^[0-9]+_{{ asn_number }}
!
ip prefix-list DEFAULT_IPV4 permit 0.0.0.0/0
ip prefix-list IPV4_30_OR_LONGER permit 0.0.0.0/0 ge 30
ip prefix-list IPV4_27_OR_LONGER permit 0.0.0.0/0 ge 27
!
!
{% if constants.bgp.allow_list is defined and constants.bgp.allow_list.enabled is defined and constants.bgp.allow_list.enabled and constants.bgp.allow_list.drop_community is defined %}
route-map ALLOW_LIST_DEPLOYMENT_ID_{{ neighbor_deployment_id }}_V4 permit 65534
  match as-path BBR_AS_PATH
!
{% if allow_list_default_action == 'deny' %}
route-map ALLOW_LIST_DEPLOYMENT_ID_{{ neighbor_deployment_id }}_V4 permit 65535
  set community no-export additive
!
{% else %}
route-map ALLOW_LIST_DEPLOYMENT_ID_{{ neighbor_deployment_id }}_V4 permit 65535
  set community {{ constants.bgp.allow_list.drop_community }} additive
!
{% endif %}
!
{% endif %}
!
route-map TO_TYCOON_ER_V4 permit 100
  match ip address prefix-list DEFAULT_IPV4
  match community UPSTREAM_PREFIX
!
route-map TO_TYCOON_ER_V4 deny 10000
!
route-map FROM_TYCOON_ER_V4 permit 100
  match ip address prefix-list DEFAULT_IPV4
  match community UPSTREAM_PREFIX
  set local-preference 90
!
route-map FROM_TYCOON_ER_V4 deny 200
  match community LEAK_COMMUNITY
!
!
{% if constants.bgp.allow_list is defined and constants.bgp.allow_list.enabled is defined and constants.bgp.allow_list.enabled %}
route-map FROM_TYCOON_ER_V4 permit 300
  call ALLOW_LIST_DEPLOYMENT_ID_{{ neighbor_deployment_id }}_V4
  on-match next
!
route-map FROM_TYCOON_ER_V4 permit 400
  match community drop_community
!
{% endif %}
!
route-map FROM_TYCOON_ER_V4 permit 500
  match community TYCOON_ER_COMMUNITY
  match ip address prefix-list IPV4_30_OR_LONGER
!
route-map FROM_TYCOON_ER_V4 permit 600
  match community SDN_APPLIANCE_COMMUNITY
  match ip address prefix-list IPV4_27_OR_LONGER
!
route-map FROM_TYCOON_ER_V4 deny 10000
!
! end of template: bgpd/templates/msft.general/v4.leaf.tor.tycoon/policy.conf.j2
!
