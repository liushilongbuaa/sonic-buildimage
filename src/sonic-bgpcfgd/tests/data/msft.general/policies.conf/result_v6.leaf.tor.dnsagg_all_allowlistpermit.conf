!
! template: bgpd/templates/general/policies.conf.j2
!
! template: bgpd/templates/msft.general/v6.leaf.tor.dnsagg/policy.conf.j2
!
bgp community-list standard DNS_VIP_COMMUNITY permit 8075:9303
bgp community-list standard UPSTREAM_PREFIX permit 8075:54000
bgp community-list standard drop_community permit no-export
!
bgp as-path access-list BBR_AS_PATH permit ^[0-9]+_65100
!
ipv6 prefix-list DEFAULT_IPV6 permit ::/0
ipv6 prefix-list IPV6_64_ONLY permit ::/0 ge 64 le 64
ipv6 prefix-list IPV6_60_OR_LONGER permit ::/0 ge 60 le 64
!
route-map ALLOW_LIST_DEPLOYMENT_ID_19_V6 permit 65534
  match as-path BBR_AS_PATH
!
route-map ALLOW_LIST_DEPLOYMENT_ID_19_V6 permit 65535
  set community 12345:12345 additive
!
route-map TO_DNS_AGG_V6 permit 100
  match ipv6 address prefix-list DEFAULT_IPV6
!
route-map TO_DNS_AGG_V6 deny 10000
!
route-map FROM_DNS_AGG_V6_19 permit 100
 set ipv6 next-hop prefer-global
 on-match next
!
route-map FROM_DNS_AGG_V6_19 permit 200
  match ipv6 address prefix-list DEFAULT_IPV6
  match community UPSTREAM_PREFIX
  set local-preference 90
!
route-map FROM_DNS_AGG_V6_19 permit 300
  call ALLOW_LIST_DEPLOYMENT_ID_19_V6
  on-match next
!
route-map FROM_DNS_AGG_V6_19 permit 400
  match community drop_community
!
route-map FROM_DNS_AGG_V6_19 permit 500
  match community DNS_VIP_COMMUNITY
  match ipv6 address prefix-list IPV6_60_OR_LONGER
!
route-map FROM_DNS_AGG_V6_19 permit 600
  match ipv6 address prefix-list IPV6_64_ONLY
!
route-map FROM_DNS_AGG_V6_19 deny 10000
!
! end of template: bgpd/templates/msft.general/v6.leaf.tor.dnsagg/policy.conf.j2
!
! end of template: bgpd/templates/general/policies.conf.j2
!
